pipeline {
    agent {label "DERDAPP006"}
    options {
        durabilityHint 'MAX_SURVIVABILITY'
        disableConcurrentBuilds()
        disableResume()
    }
    stages {
        stage ('getsnapshots') {
            steps {
                script {
                    pwsh '''
                        $PSStyle.OutputRendering = [System.Management.Automation.OutputRendering]::PlainText;
                        . ${env:WORKSPACE}/functions/new-snapshot.ps1
                        . ${env:WORKSPACE}/functions/remove-snapshot.ps1
                        . ${env:WORKSPACE}/functions/get-snapshot.ps1
                        write-host "Start.....`n"
                        $result=new-snapshot -clean -verbose
                        $result|out-string
                        write-host "....End"
                    '''
                }
            }
        }
    }
}